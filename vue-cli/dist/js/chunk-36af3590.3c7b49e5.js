(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-36af3590"],{"1f4c":function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("transition",{attrs:{name:"dialog"}},[t.showDialog?a("div",{staticClass:"dialog-mask"},[a("div",{staticClass:"dialog-wrapper"},[a("div",{staticClass:"dialog-container",class:t.getContainerClass()},[a("div",{staticClass:"dialog-header d-flex"},[t._t("header",[t._v("default header")])],2),a("div",{staticClass:"dialog-body"},[t._t("body",[t._v("default body")])],2),a("div",{staticClass:"dialog-footer"},[t._t("footer",[a("div",{staticClass:"d-flex"},[a("button",{staticClass:"btn btn-secondary",on:{click:function(e){t.$emit("cancel")}}},[t._v("キャンセル")]),a("button",{staticClass:"btn btn-primary mr-0 ml-auto",on:{click:function(e){t.$emit("ok")}}},[t._t("ok",[t._v("OK")])],2)])])],2)])])]):t._e()])},s=[],r={name:"CommonDialog",data:function(){return{errors:[]}},props:["showDialog","classList"],methods:{getContainerClass:function(){if(null!=this.classList&&this.classList.length>0)return this.classList.join(" ")}}},n=r,o=(a("b9d8"),a("2877")),l=Object(o["a"])(n,i,s,!1,null,"5ad9875a",null);l.options.__file="CommonDialog.vue";e["a"]=l.exports},"21ba":function(t,e,a){"use strict";var i=a("ad1e"),s=a.n(i);s.a},4657:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("main",{staticClass:"container-fluid"},[a("div",{staticClass:"row"},[a("div",{staticClass:"col-12"},[a("div",{staticClass:"input-group mb-3"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.url,expression:"url"}],staticClass:"form-control",attrs:{type:"text",placeholder:"スクレイプ対象URL"},domProps:{value:t.url},on:{input:function(e){e.target.composing||(t.url=e.target.value)}}}),a("div",{staticClass:"input-group-append"},[a("button",{staticClass:"btn btn-primary",on:{click:t.getTargetSite}},[t._v("取得")])])])]),a("div",{staticClass:"col-12 vh-100"},[a("div",{staticClass:"active-element h-75"},[a("div",{staticClass:"card"},[a("div",{staticClass:"card-header py-1"},[t._v("選択中の要素")]),a("div",{staticClass:"card-body p-1"},[a("div",{staticClass:"card-title"},[t._v(t._s(t.removeProtocolAndDomain(t.iframeSource)))]),a("ul",[a("li",[t._v("TAG: "+t._s(t.activeElement.tag))]),a("li",[t._v("ID: "+t._s(t.activeElement.id))]),a("li",[t._v("CLASS: "+t._s(t.activeElement.className))]),a("li",[t._v("NAME: "+t._s(t.activeElement.name))]),a("li",[t._v("INDEX: "+t._s(t.activeElement.index))])]),a("div",{staticClass:"d-flex mb-1"},[a("button",{staticClass:"btn btn-sm btn-primary w-100 mr-1",on:{click:t.registerTarget}},[t._v("ウォッチ")]),a("button",{staticClass:"btn btn-sm border-primary bg-white w-100 mr-1",on:{click:t.selectParentNode}},[t._v("親選択")]),a("button",{staticClass:"btn btn-sm border-primary bg-white w-100 mr-1",on:{click:t.clearWatched}},[t._v("解除")])])])]),a("div",{staticClass:"card mt-2"},[a("div",{staticClass:"card-header py-1"},[t._v("ウォッチリスト")]),a("div",{staticClass:"card-body p-1",staticStyle:{"min-height":"8em"}},[a("ul",{staticClass:"p-1"},t._l(t.registeredList,function(e,i){return a("li",{key:i,staticClass:"badge badge-primary mr-1 mb-1",on:{click:function(a){t.activateRegisteredContents(i,e,a)}}},[a("i",{staticClass:"fas fa-tag mr-1"}),t._v(t._s(i)+":"+t._s(e.tag)),a("i",{staticClass:"fas fa-trash ml-2",on:{click:function(a){a.stopPropagation(),t.removeTarget(i,e)}}})])}),0)])]),a("div",{staticClass:"w-100",staticStyle:{position:"absolute",bottom:"0"}},[a("button",{staticClass:"btn btn-primary w-100",on:{click:t.popupScenario}},[t._v("シナリオ"+t._s(this.registerType))])])]),a("iframe",{staticClass:"w-100 h-100 border border-info rounded",attrs:{type:"text/html",id:t.iframeId,src:t.iframeSource},on:{load:t.iframeLoaded}})])]),a("scenarioModal",{attrs:{showModal:t.showModal,url:t.url,siteTitle:t.iframeTitle,registeringErrors:t.registeringErrors,dir:t.removeProtocolAndDomain(t.iframeSource),scenario:t.scenario,type:t.registerType},on:{save:t.registerScenario,close:function(e){t.showModal=!1}}}),a("alertModal",{attrs:{showDialog:t.showAlertModal}},[a("div",{staticClass:"text-danger",attrs:{slot:"header"},slot:"header"},[a("i",{staticClass:"fas fa-exclamation-triangle mr-2"}),t._v("スクレイピングエラー")]),a("div",{attrs:{slot:"body"},slot:"body"},[t._v(t._s(t.alertMessage))]),a("div",{staticClass:"text-right",attrs:{slot:"footer"},slot:"footer"},[a("span",{staticClass:"btn btn-primary",on:{click:function(e){t.alertMessage=null}}},[t._v("OK")])])])],1)},s=[],r=(a("f751"),a("53ca")),n=(a("ac6a"),a("456d"),a("55dd"),a("28a5"),a("4917"),a("3b2b"),a("cadf"),a("551c"),a("097d"),function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("transition",{attrs:{name:"modal"}},[t.showModal?a("div",{staticClass:"modal-mask"},[a("div",{staticClass:"modal-wrapper"},[a("div",{staticClass:"modal-container"},[a("div",{staticClass:"modal-header d-flex"},[a("div",[t._v("シナリオ"+t._s(t.type))]),t.scenario?a("div",{staticClass:"small text-secondary"},[t._v("ID:"+t._s(t.scenario._id))]):t._e()]),a("div",{staticClass:"modal-body"},[a("div",{staticClass:"form-group"},[a("label",[t._v("Base URL:")]),a("input",{staticClass:"form-control",attrs:{disabled:""},domProps:{value:t.url}})]),a("div",{staticClass:"row"},[a("div",{staticClass:"col-12 form-group"},[a("label",[t._v("シナリオ名:")]),a("input",{directives:[{name:"model",rawName:"v-model",value:t.scenarioName,expression:"scenarioName"}],staticClass:"form-control",attrs:{type:"text"},domProps:{value:t.scenarioName},on:{input:function(e){e.target.composing||(t.scenarioName=e.target.value)}}})]),a("div",{staticClass:"col-4 form-group"},[a("label",[t._v("次回予定日:")]),a("input",{directives:[{name:"model",rawName:"v-model",value:t.nextCrawlingDate,expression:"nextCrawlingDate"}],staticClass:"form-control",attrs:{type:"date"},domProps:{value:t.nextCrawlingDate},on:{input:function(e){e.target.composing||(t.nextCrawlingDate=e.target.value)}}})]),a("div",{staticClass:"col-4 form-group"},[a("label",[t._v("実行間隔:")]),a("div",[a("div",{staticClass:"btn-group btn-group-toggle w-100"},[a("label",{staticClass:"btn border border-primary w-100",class:{active:t.isActiveInterval(1)}},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.interval,expression:"interval"}],attrs:{type:"radio",value:"1"},domProps:{checked:t._q(t.interval,"1")},on:{change:function(e){t.interval="1"}}}),t._v("週１")]),a("label",{staticClass:"btn border border-primary w-100",class:{active:t.isActiveInterval(2)}},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.interval,expression:"interval"}],attrs:{type:"radio",value:"2"},domProps:{checked:t._q(t.interval,"2")},on:{change:function(e){t.interval="2"}}}),t._v("月１")])])])]),a("div",{staticClass:"col-4 form-group"},[a("label",[t._v("Notification:")]),a("div",{staticClass:"btn-group btn-group-toggle w-100"},t._l(t.notifications,function(e,i){return a("label",{key:i,staticClass:"btn border border-primary",class:{active:t.isActiveNotification(e.value)}},[t._v(t._s(e.text)),a("input",{directives:[{name:"model",rawName:"v-model",value:t.notification,expression:"notification"}],attrs:{type:"checkbox"},domProps:{value:e.value,checked:Array.isArray(t.notification)?t._i(t.notification,e.value)>-1:t.notification},on:{change:function(a){var i=t.notification,s=a.target,r=!!s.checked;if(Array.isArray(i)){var n=e.value,o=t._i(i,n);s.checked?o<0&&(t.notification=i.concat([n])):o>-1&&(t.notification=i.slice(0,o).concat(i.slice(o+1)))}else t.notification=r}}})])}),0)]),a("div",{staticClass:"col-8 form-group"},[a("label",[t._v("Mail:")]),a("select",{directives:[{name:"model",rawName:"v-model",value:t.notificationMail,expression:"notificationMail"}],staticClass:"form-control",on:{change:function(e){var a=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){var e="_value"in t?t._value:t.value;return e});t.notificationMail=e.target.multiple?a:a[0]}}},t._l(t.users,function(e,i){return a("option",{domProps:{value:e.mail}},[t._v(t._s(e.mail))])}),0)])]),a("div",{directives:[{name:"show",rawName:"v-show",value:t.errors.length>0,expression:"errors.length>0"}],staticClass:"alert alert-danger my-1"},[a("ul",{staticClass:"mb-0 pl-3"},t._l(t.errors,function(e,i){return a("li",{key:i},[t._v(t._s(e))])}),0)])]),a("div",{staticClass:"modal-footer"},[a("button",{staticClass:"btn btn-secondary mr-3",on:{click:t.close}},[t._v("CLOSE")]),a("button",{staticClass:"btn btn-primary",on:{click:t.save}},[t._v("SAVE")])])])])]):t._e()])}),o=[],l=(a("7f7f"),a("7514"),a("9e3a")),c={name:"Scenario",data:function(){return{notification:null,notifications:[{text:"All",value:1},{text:"Part",value:2},{text:"Capture",value:4}],scenarioName:null,notificationMail:null,nextCrawlingDate:null,interval:1,errors:[],users:l}},props:["showModal","url","siteTitle","registeringErrors","dir","scenario","type"],methods:{close:function(){this.$emit("close")},init:function(){var t=new Date,e=t.getFullYear(),a=("00"+(t.getMonth()+1)).slice(-2),i=("00"+t.getDate()).slice(-2);this.nextCrawlingDate=e+"-"+a+"-"+i,this.notification=[1,2,4],this.scenarioName=null,this.notificationMail=null},save:function(){if(this.error=[],this.scenarioName||this.errors.push("シナリオ名を入力してください"),this.nextCrawlingDate||this.errors.push("次回クロール予定日を入力してください"),0===this.error.length){var t={url:this.url,name:this.scenarioName,date:this.nextCrawlingDate,notify:this.notification,mail:this.notificationMail,interval:this.interval,dir:this.dir};this.close(),this.$emit("save",t)}},isActiveInterval:function(t){return t===parseInt(this.interval)},isActiveNotification:function(t){return null!=this.notification.find(function(e){return e===t})}},mounted:function(){this.init()},watch:{siteTitle:function(){this.scenarioName=""+this.siteTitle.trim()},registeringErrors:function(){console.error(this.errors,this.registeringErrors)},scenario:function(){this.scenarioName=this.scenario.name,this.notificationMail=this.scenario.mail,this.notification=this.scenario.notify;var t=new Date(this.scenario.date),e=t.getFullYear(),a=("00"+(t.getMonth()+1)).slice(-2),i=("00"+t.getDate()).slice(-2);this.nextCrawlingDate=e+"-"+a+"-"+i,this.interval=this.scenario.interval}}},d=c,u=(a("4d9f"),a("2877")),m=Object(u["a"])(d,n,o,!1,null,"83cd0e76",null);m.options.__file="ScenarioModal.vue";var v=m.exports,f=a("1f4c"),h=a("bc3a"),g={components:{scenarioModal:v,alertModal:f["a"]},props:["scenarioId"],name:"Scenario",data:function(){return{url:null,scrapedUrl:null,scrapingApiUrl:this.$apiUrl+"/scrape",registerApiUrl:this.$apiUrl+"/scenario",getApiUrl:this.$apiUrl+"/scenario",iframeSource:null,iframeTitle:null,iframeId:"crawled-result",iframeRegisteredClass:"iframe-registered",iframeActiveClass:"iframe-active",activeElement:{tag:null,id:null,className:null,name:null,index:null},registeredList:[],registeredScenario:null,registeringErrors:[],activeTagClass:"active-tag",showModal:!1,scenario:null,registerType:"登録",alertMessage:null}},computed:{showAlertModal:function(){return this.alertMessage}},methods:{getTargetSite:function(){var t=this;try{var e=new RegExp("((https?|ftp)(://[-_.!~*'()a-zA-Z0-9;/?:@&=+$,%#]+))");if(!this.url)throw new Error("URLを入力してください");if(!this.url.match(e))throw new Error("http://〜 または、https://〜 の形式でURLを入力してください");this.$lock("HTML取得中...");var a=this.scrapingApiUrl+"?url="+this.url;h.get(a).then(function(e){if(200!==e.status)throw new Error("error");t.iframeSource=t.$dataUrl+"/tmp/"+e.data.result,t.scrapedUrl=t.url}).catch(function(e){t.alertMessage=e.message,console.error(e),t.$unlock()})}catch(i){this.alertMessage=i.message,console.error(i),this.$unlock()}},iframeLoaded:function(){document.getElementById(this.iframeId).src?(document.getElementById(this.iframeId).contentWindow.postMessage({type:"init"},"*"),this.$unlock()):console.error("iframe source is empty")},removeProtocolAndDomain:function(t){return null!=t&&t.length>0?t.split("/").pop():null},clearActiveTag:function(){var t=document.getElementsByClassName(this.activeTagClass);for(var e in t)t.hasOwnProperty(e)&&t[e].classList.remove(this.activeTagClass)},clearWatched:function(){this.clearActiveTag(),document.getElementById(this.iframeId).contentWindow.postMessage({type:"clear"},"*")},hideSelected:function(){},showHiddenElements:function(){},activateRegisteredContents:function(t,e,a){this.clearActiveTag(),document.getElementById(this.iframeId).contentWindow.postMessage({type:"activate",data:e},"*"),document.getElementById(this.iframeId).contentWindow.postMessage({type:"get"},"*"),a.currentTarget.classList.add(this.activeTagClass)},registerTarget:function(){var t=function t(e){var a=Object.keys(e).sort(),i={};return a.forEach(function(a){var s=e[a];"object"===Object(r["a"])(s)&&(s=t(s)),i[a]=s}),i},e=JSON.stringify(t(this.activeElement)),a=null,i=this.registeredList,s=!0;for(var n in i)if(i.hasOwnProperty(n)&&(a=JSON.stringify(t(i[n])),e===a)){s=!1;break}s&&i.push(this.activeElement)},removeTarget:function(t,e){this.registeredList.splice(t,1)},selectParentNode:function(t){this.clearActiveTag(),document.getElementById(this.iframeId).contentWindow.postMessage({type:"parent"},"*")},popupScenario:function(t){null!=this.scrapedUrl&&null!=this.iframeSource&&(document.getElementById(this.iframeId).contentWindow.postMessage({type:"title"},"*"),this.showModal=!0)},registerScenario:function(t){var e=this;if(t){this.$lock("".concat(this.registerType,"中..."));var a=this.registerApiUrl;t.actions=this.registeredList,this.scenarioId?(t.id=this.scenarioId,console.log(t),h.put(a,t).then(function(t){if(200===t.status&&null===t.data.error)return e.showModal=!1,t.data.id;throw e.registeringErrors=t.data.error,new Error("error")}).then(function(t){setTimeout(e.$router.push("/"),2e3)}).catch(function(t){alert("error"),console.log(t)}).then(function(){return e.$unlock()})):h.post(a,t).then(function(t){if(200===t.status&&null===t.data.error)return e.showModal=!1,t.data.id;throw e.registeringErrors=t.data.error,new Error("error")}).then(function(t){setTimeout(e.$router.push("/"),2e3)}).catch(function(t){alert("error"),console.log(t)}).then(function(){return e.$unlock()})}},getScenario:function(t){var e=this;if(this.scenario=null,t){this.$lock("取得中...");var a=this.getApiUrl+"?id=".concat(t);h.get(a).then(function(t){if(200!==t.status)throw console.log(t),new Error("error");e.registeredScenario=t.data,e.url=t.data.url,e.scrapedUrl=t.data.url,e.registeredList=t.data.actions,e.iframeSource="".concat(e.$dataUrl,"/scenario/").concat(t.data._id,"/").concat(t.data.dir),e.scenario=t.data}).catch(function(t){return console.log(t)}).then(function(){return e.$unlock()})}},setIframeTitle:function(t){this.iframeTitle=t}},mounted:function(){var t=this;window.addEventListener("message",function(e){try{if("object"===Object(r["a"])(e.data)){var a=e.data;switch(a.type){case"get":t.activeElement=Object.assign({},a.data);break;case"click":case"parent":t.clearActiveTag(),t.activeElement=Object.assign({},a.data);break;case"title":t.scenarioId||t.setIframeTitle(a.data);break;default:console.log(e);break}}}catch(i){console.error(i)}},!1)},watch:{scenarioId:function(){this.getScenario(this.scenarioId),this.registerType="更新"}}},p=g,b=(a("21ba"),Object(u["a"])(p,i,s,!1,null,"3a1704c8",null));b.options.__file="ScenarioForm.vue";e["a"]=b.exports},"4d9f":function(t,e,a){"use strict";var i=a("a7ea"),s=a.n(i);s.a},9340:function(t,e,a){},"9e3a":function(t){t.exports=[{id:1,name:"hoge",mail:"hoge@example.com"},{id:2,name:"piyo",mail:"piyo@example.com"}]},a7ea:function(t,e,a){},ad1e:function(t,e,a){},b9d8:function(t,e,a){"use strict";var i=a("9340"),s=a.n(i);s.a}}]);
//# sourceMappingURL=chunk-36af3590.3c7b49e5.js.map